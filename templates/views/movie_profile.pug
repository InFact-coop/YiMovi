extends ../layouts/base
include ../mixins/snippets
include ../mixins/img-gallery.pug
include ../mixins/social.pug


block content
  
  //- Helper
  - const firstKey = (obj) => Object.keys(obj)[0]
  
  //- Additional sections possible
  - const sections = [ "context", "synopsis", "cinematography", "pointsForDiscussion", "externalLinks" ]
  
  //- Query checks
  - const hasVideo = movie.video !== undefined
  - const hasImages = (movie.gallery !== undefined) && movie.gallery.length !== 0
  - const hasNotesSection = sections.some(s => movie[s].html && movie[s].html.length)
  
  //- title and main details
  - const movieTitle = movie.name + (movie.name_chn.length ? ` (${movie.name_chn})` : '')
  
  #title-container.pa1.pl2.mt5-ns.mt4.pa2-ns.pl3-ns.shadow-5.z-1(class=`bg-${primaryColor}`)
      
    +breadcrumbs("movies", movie.name)
    
    
    if (movie.name_chn)
      h1.light-gray.ttu.f2.f1-ns.fw7.lh-copy.ma0.sans-serif=movie.name
    h2.light-gray.ttu.f3.f3-ns.fw7.lh-title.ma0=movie.name_chn
      
    h2.light-gray.f5.f4-ns.fw2.lh-title
      if movie.year
        span.mr2=movie.year
      if movie.duration
        span.mh2=movie.duration + ' mins'
      if movie.director && (movie.year || movie.duration)
        span.mh2 |
      if movie.director
        a.no-underline(href=`/directors/${directorPage}`)
          span.mh2.white=`${__.movie_profile.director} ${director.name}`
      if movie.director.name_chn
        a.no-underline(href=`/directors/${directorPage}`)
          span.white.ma0.sans-serif=`${director.name_chn}`      

  //- pa2.pa3-ns 
  #menu.shadow-5.pl2.z-1.sticky.top-1-9.top-4-ns.light-gray(class=`bg-${secondaryColor}`)
    #menu-mobile.flex.flex-row.justify-between.items-center.pointer.dn-ns.pv1.pv0-m
      p.ma0.f5.fw7.ttu=movie.name
      img.h2.mr3(src="/arrow_drop_down_black.svg")
    ul#drop-down.list.flex-ns.flex-column.flex-row-ns.items-center.pa0.pv2.justify-start.ma0.dn
      li.ttu.mr4.fw7.pv2.pv0-ns.dn.flex-ns=movie.name + ':'
        +profileMenuItem("summary", __.movie_profile.summary)
      if hasVideo
        +profileMenuItem("video",  __.movie_profile.video)
      if hasImages
        +profileMenuItem("images",  __.movie_profile.images)
      if hasNotesSection
        +profileMenuItem("screening",  __.movie_profile.screening_notes)
  
        
  if movie.image.secure_url
    #image-container.flex.flex-column.justify-center.h4.h6-ns.bg-near-white.relative.z--1
      span.h-100.contain.no-repeat.dib.relative.w-100.self-center.mw7(style=`background-image:url("${movie.image.secure_url}"); background-repeat: no-repeat; background-position: center`)
    
  #content.pa3.pa5-ns.mw8.center
        
    //- summary section
    a#anchor-summary.anchor-ns.anchor(tabindex="-1")  
    section#summary.flex.justify-start
      
    +section(movie, "summary", `${__.movie_profile.intro}`)
      
    //- video section
    if movie.video && movie.video.includes("mediacentral.ucl.ac.uk")
      a#anchor-video.anchor-ns.anchor(tabindex="-1")
      hr.mt3.mb3
      section#video.flex.flex-column
        +sectionHeading(`${__.movie_profile.video}`)

        div.relative.pb-video.h0.bg-black
          +video(videoId)
        if movie.videoLinks.html
          +subHeading(`${__.movie_profile.more_video_links}`)
          #video-links.f6.f5-ns
            !=movie.videoLinks.html
    
    //- gallery section
    if movie.gallery.length
      a#anchor-images.anchor-ns.anchor(tabindex="-1")    
      hr.mh0.mv3
      - const imgArray = movie.gallery
      - const imgHolderStyle = `width:${100 * imgArray.length}%`
      
      section#gallery.flex.flex-column
        +sectionHeading(`${__.movie_profile.image_gallery}`)
        // - image slider
        div.slider-holder.w-100.h4.h6-ns.center.mt0.overflow-hidden.tc
          each _, spanIndex in imgArray  
            +sliderHolder(spanIndex)
          .image-holder.h4.h6-ns.relative.cb.trans-slide(style=imgHolderStyle)
            each img in imgArray
              +galleryImage(img, imgArray.length)
      div
      .button-holder.relative.tc.mt1
        img.h1.v-mid.pa2(src="/leftarrow.png")
        each _, linkIndex in imgArray
          +galleryLink(linkIndex)
        img.h1.center.v-mid.pa2(src="/rightarrow.png")

    if hasNotesSection
      a#anchor-screening.anchor-ns.anchor(tabindex="-1")
        
    //- context section
    +section(movie, 'context', `${__.movie_profile.context}`)
    
    //- synopsis
    +section(movie, 'synopsis', `${__.movie_profile.synposis}`)
        
    //- cinematography
    +section(movie, 'cinematography', `${__.movie_profile.cinematography}`)
        
    //- points for discussion
    +section(movie, 'pointsForDiscussion', `${__.movie_profile.points_for_discussion}`)
        
    //- external links
    if movie.externalLinks.html && movie.externalLinks.html.length
      hr.mh0.mv3
      +sectionHeading(`${__.movie_profile.external_links}`)
      #external-links.f6.f5-ns
        !=movie.externalLinks.html
        
    //- teaching & learning
    +section(movie, 'bibliography', `${__.movie_profile.teaching_and_learning}`)
    //- share
    hr.mh0.mv3
    +sectionHeading(`${__.movie_profile.share}`)
    +socialIcons(full_url)
    
block scripts
  script
    include ../js/main.js
    include ../js/menu.js
